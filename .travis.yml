language: php

notifications:
  email:
    on_success: never
    on_failure: change
    
dist: precise

php:
  - 5.6

env:
  - WP_MULTISITE=0 WP_CEPT_SERVER='127.0.0.1:4444' WP_CORE_DIR=/tmp/wordpress WP_VERSION=latest

# ##############################################################################
# @todo: Currently, the matrix is not working with codeception / phantomjs
# matrix:
#   include:
#     - php: 5.6
#       env: WP_VERSION=4.7.5 WP_CORE_DIR=/tmp/wordpress-4.7.6
#     - php: 5.6
#       env: WP_VERSION=4.6.1 WP_CORE_DIR=/tmp/wordpress-4.6.1
# ##############################################################################

before_script:
  - composer update
  - bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION
  # Start up a web server / webdriver
  - php -S "$WP_CEPT_SERVER" -t "$WP_CORE_DIR" >/dev/null 2>&1 &
  - phantomjs --webdriver=4444 >/dev/null 2>&1 &
  # Install Codeception and WP Browser.
  # Doing this last gives the webdriver and server time to start up.
  - composer install --prefer-source
  - sleep 2s;

# script: phpunit --debug
script:
  - vendor/wp-cli/wp-cli/bin/wp config create --path=$WP_CORE_DIR --dbname=wordpress_test --dbuser=root --dbpass=''
  - vendor/wp-cli/wp-cli/bin/wp core install --path=$WP_CORE_DIR --url=http://127.0.0.1:4444 --title=Example --admin_user=admin --admin_password=password --admin_email=bradm@boldgrid.com 
  - vendor/bin/codecept run --debug

after_script:
  cat /home/travis/build/BoldGrid/boldgrid-inspirations/tests/codeception/_output/basicCept.fail.html;